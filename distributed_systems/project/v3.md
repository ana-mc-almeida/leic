## Notas Variante 3

### Dicas do professor

- Menos linhas de c√≥digo mas mais tempo para perceber o algoritmo
- RME (mas tem de ser ligeiramente alterada)
- Difus√£o Fi√°vel At√≥mica = Difus√£o Fi√°vel Total / Ordenada
  - Em teoria demos isto na te√≥rica ü´£
  - Podemos assumir que √© sempre **fi√°vel** (servidores nunca falham)
- Antes de enviar o pedido, o client tem de obter o n√∫mero de sequencia
- Antes de executar qualquer pedido, cada servidor checka o n√∫mero de sequ√™ncia do pedido (e s√≥ o realiza se corresponder ao n√∫mero de pedido seguinte)
  - Bloquear com `wait` dentro de um `if` (que v√™ se √© o n√∫mero de pedido seguinte)
  - Desbloquear com com `notifyAll` quando acaba de executar qualquer pedido
- Temos de ver como lidar com um `take` de um tuplo que n√£o exista
  - isto vai obrigar a que seja possivel executar um `put` de seguida, mas temos de ver como fazer isto
  - Temos de conseguir fazer isso para mais do que um take √† espera
  - O stor disse que em pr√≠ncipio n√£o podemos utilizar o `notifyAll`
  - Stor deu a entender a outro grupo que √© para utilizar `conditions`
- `Reads` n√£o tem restri√ß√£o de ordem total, podemos utilizar o `notifyAll` quando recebemos um put
  - Utilizar `conditions`
  - Colocar os reads numa fila de espera s√≥ para eles

### Casos a testar

- [ ] Todos os testes das √∫ltimas entregas
- [X] Um take antes de um put
- [X] Mais do que um take que corresponda ao mesmo tuplo (em que n√£o existe esse tuplo no TupleSpaces) e quando se faz s√≥ um `put` tem de sair s√≥ o **primeiro** `take`
- [X] Quando h√° um `take` (sem o tuplo estar no tupleSpaces) seguido de um `put` seguido de um `take` (tudo isto com **o mesmo tuplo**)

### Utils

Run NamingServer:
```
python server.py -debug
```

Run Server A
```
mvn compile exec:java -Dexec.args="2001 A" -Ddebug
```
Run Server B
```
mvn exec:java -Dexec.args="2002 B"
```
Run Server C
```
mvn exec:java -Dexec.args="2003 C"
```

Run Sequencer
```
mvn compile exec:java
```

Run Client
```
mvn compile exec:java -Ddebug
```

### Ask Alice

- [X] Confirmar que n√£o √© preciso o clientId
- [X] Esperar pelos 3 servers ou s√≥ por um?
  - Put & take esperam pelos 3 e o read espera por 1
  - [ ] Temos de checkar os erros ou n√£o?
    - Exemplo: `List<Throwable> errors = takeCollector.getErrors();`
- [X] Cenas do server na pasta utils
- [X] **acho** que o exit do client n√£o est√° a funcionar a 100%

### TODO

- [X] ver o next no put
- [ ] p√¥r as fun√ß√µes numa ordem que fa√ßa sentido
- [X] p√¥r debbugs bonitos
- [ ] ver se os locks est√£o nos s√≠tios certos
- [ ] Voltar a testar tudo

### Ask teacher

- [X] Esperar pelos 3 servers ou s√≥ por um?
  - como assumimos que eles nunca falham, n√£o precisamos de esperar por nenhum, mas o stor n√£o vai avaliar isso
- [X] Locks onde?
  - Sempre que mexemos com uma lista (seja ler ou escrever)